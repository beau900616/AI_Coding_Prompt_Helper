<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>生成程式需求表單</title>
    <style>
        .purpose-item {
            margin-bottom: 10px;
        }
        .purpose-textarea {
            width: 500px;
            height: 60px;
            resize: vertical;
        }
    </style>
    <script>
        function updatePurposePlaceholders() {
            const items = document.querySelectorAll('.purpose-item textarea');
            items.forEach((textarea, index) => {
                textarea.placeholder = `用途項目 ${index + 1}`;
            });
        }

        function addPurposeItem() {
            const container = document.getElementById("purpose-list");

            const wrapper = document.createElement("div");
            wrapper.className = "purpose-item";

            const textarea = document.createElement("textarea");
            textarea.name = "purpose_item";
            textarea.className = "purpose-textarea";
            textarea.required = true;

            const deleteButton = document.createElement("button");
            deleteButton.type = "button";
            deleteButton.textContent = "刪除";
            deleteButton.onclick = function () {
                const allItems = container.querySelectorAll('.purpose-item');
                if (allItems.length > 1) {
                    container.removeChild(wrapper);
                    updatePurposePlaceholders();//重新編號
                } else {
                    alert("至少需要一個用途項目！");
                }
            };

            wrapper.appendChild(textarea);
            wrapper.appendChild(deleteButton);
            container.appendChild(wrapper);
            updatePurposePlaceholders();//重新編號
        }

        // 預設初始化一個用途項目
        window.onload = function () {
            addPurposeItem()
            const formData = JSON.parse('{{ form_data | tojson | safe }}');
            const purposes = formData ? formData.purpose_items : [];

            if (purposes.length > 0) {
                purposes.forEach(item => addPurposeItem(item));
            } else {
                addPurposeItem();
            }

            // 回填其他欄位
            if (formData) {
                document.getElementsByName('terms_and_definitions')[0].value = formData.terms_and_definitions || '';
                document.getElementsByName('references')[0].value = formData.references || '';
                document.getElementsByName('language')[0].value = formData.language || 'Python';
                document.getElementsByName('design_method')[0].value = formData.design_method || '';
                document.getElementsByName('system_structure')[0].value = formData.system_structure || '';
                document.getElementsByName('input_data_explain')[0].value = formData.input_data_explain || '';
                document.getElementsByName('output_data_explain')[0].value = formData.output_data_explain || '';
                document.getElementsByName('constraints')[0].value = formData.constraints || '';
            }
        }
    </script>
</head>
<body>
    <h1>請輸入程式功能需求</h1>
    <form method="post">
        <h2>前言</h2>
        <label>文件目的：</label><br>
        <div id="purpose-list"></div>
        <button type="button" onclick="addPurposeItem()">新增一行用途</button><br><br>

        <label>名詞解釋：</label><br>
        <textarea name="terms_and_definitions" class="purpose-textarea"></textarea><br><br>

        <label>參考資料：</label><br>
        <textarea name="references" class="purpose-textarea"></textarea><br><br>

        <h2>軟體設計規劃</h2>
        <label>使用語言：</label><br>
        <input type="text" name="language" value="Python" required><br><br>

        <label>設計方法與工具：</label><br>
        <textarea name="design_method" class="purpose-textarea"></textarea><br><br>

        <label>系統架構：</label><br>
        <textarea name="system_structure" class="purpose-textarea"></textarea><br><br>

        <label>輸入資料型態說明：</label><br>
        <textarea name="input_data_explain" class="purpose-textarea"></textarea><br><br>

        <label>輸出資料型態說明：</label><br>
        <textarea name="output_data_explain" class="purpose-textarea"></textarea><br><br>
        
        <label>特殊限制或其他需求：</label><br>
        <textarea name="constraints" class="purpose-textarea"></textarea><br><br>

        <button type="submit">生成 ChatGPT 提示</button>
    </form>
</body>
</html>
